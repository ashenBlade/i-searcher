# i-searcher

Консольный инструмент для информационного поиска по множеству документов


# Стемминг

Для приведения слов к общему виду я использую алгоритм [Snowball](https://snowballstem.org/algorithms/russian/stemmer.html).
Реализация находится в [src/stemmer/RussianStemmer.cpp](./src/stemmer/RussianStemmer.cpp).

# Алгоритм ранжирования

В качестве алгоритма ранжирования используется [Best Match 25 (BM25)](https://ru.wikipedia.org/wiki/Okapi_BM25).
При запуске приложения имеется возможность указания параметров: k и b.
Значения по умолчанию:
- k - `2`
- b - `0.75`

# Сборка

Для сборки используется CMake. Исходники располагаются в `src`.

Скрипт сборки (запускается из корня репозитория)

```shell
mkdir build && cd build
cmake ../src
make
```

В директории `build` будет содержаться исполняемый файл `isearch`.

Дальше, для более удобной работы предлагаю обновить `$PATH`, для доступа к исполняемому файлу (чтобы каждый раз не указывать путь до бинарника).

```shell
# Предполагается, что запуск также из директории со сборкой - build
PATH="$PATH:$PWD"
```

# Работа 

Приложение работает в 2 режимах: инициализация и поиск

## Инициализация

Перед началом работы необходимо проинициализировать директорию с документами.
В качестве документов используются `.txt` файлы (расширение).
Содержимое - русский текст (другие языки корректно работать не будут).
Кодировка - UTF-8.

Команда: `isearch init [DIRECTORY]`
- `DIRECTORY` - путь до директории, которую нужно инициализировать. Если отсутствует, то инициализируется текущая директория 

Примеры:
- `isearch init .` - инициализировать текущую директорию
- `isearch init /home/user/Documents/Research` - инициализировать директорию `/home/user/Documents/Research` 

## Поиск

Поиск производится по уже существующей директории.

Команда: `isearch query QUERY DIRECTORY [-m|--max MAX] [-k|--bm25-k K_VALUE] [-b|--bm25-b B_VALUE]`
- `QUERY` - строка запроса по файлам. Необходимо указывать единой строкой - в кавычках. Например, `"река текла изгибаясь"` или `'футбольный матч'`
- `DIRECTORY` - директория, по которой необходимо производить поиск. В отличие от инициализации - обязательна
- `-m|--max MAX` - максимальное количество документов в результате - указывается в `MAX`
- `-k|--bm25-k K_VALUE` - значение k для алгоритма BM25 - указывается в `K_VALUE`
- `-b|--bm25-b B_VALUE` - значение b для алгоритма BM25 - указывается в `B_VALUE` 

Примеры:
- `isearch query "пятничный праздник" . -m 200` - сделать запрос по документам в текущей директории по запросу "пятничный праздник" и выдать 200 документов
- `isearch query 'стройка в центре города' /var/lib/mongodb -k 9` - сделать запрос по документам в /var/lib/mongodb с параметром k равным 9

> Вывод документов производится в порядке релевантности

# Тестирование

Для тестирования используется датасет [Lenta.ru из Kaggle](https://www.kaggle.com/datasets/yutkin/corpus-of-russian-news-articles-from-lenta?select=lenta-ru-news.csv).
Он представляется в виде csv файла, но нам нужны только поля `title` - название документа и `text` - его содержимое.
Распарсить можно этим питоновским скриптом:

```python
import csv
import os


def main():
    try:
        os.mkdir('files')
    except FileExistsError:
        pass

    with open('lenta-ru-news.csv', 'r') as lenta_file:
        reader = csv.reader(lenta_file, delimiter=',')
        next(reader)  # Пропускаем заголовок
        for line in reader:
            title = line[1]
            text = line[2]
            try:
                with open(f'files/{title}.txt', 'w') as content_file:
                    content_file.write(text)
            except FileNotFoundError:
                # Не хочу экранировать символы - так проще
                pass


if __name__ == '__main__':
    main()
```

В результате в директории `files` будут все релевантные файлы. Дальше переходим в эту директорию и работаем в ней (либо перемещаем в нужное место):

```shell
cd files
```

После скачивания и распаковки необходимо запустить инициализацию:

```shell
isearch init .
```

> Предупреждение: датасет очень большой. У меня ушло 13Гб оперативки и 30-40 минут на весь процесс.

После инициализации можно запускать тесты

```shell
isearch query 
```
